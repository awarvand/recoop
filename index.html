<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RECOOP - Reabilitação de Edifícios</title>
    <link rel="stylesheet" href="index.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap" rel="stylesheet">

</head>
<body>

    <!-- HEADER -->
    <header id="main-header" class="header">
        <div class="container header-container">
            <a href="#inicio" class="logo">
                <img src="siterecoop media/recoop_logo_1-removebg-preview.png" alt="RECOOP logo">
              </a>
              
            <nav class="main-nav">
                <a href="#inicio">Início</a>
                <a href="#sobre">Sobre Nós</a>
                <a href="#servicos">Serviços</a>
                <a href="#galeria">Galeria</a>
                <a href="#orcamentos">Orçamentos</a>
                <a href="#contactos">Contactos</a>
            </nav>
            <a href="#orcamentos" class="btn btn-primary hidden-mobile">Pedir Orçamento</a>
            <button id="mobile-menu-button" class="mobile-menu-button" aria-label="Abrir menu" aria-expanded="false">
                <svg id="menu-icon" class="icon" viewBox="0 0 24 24"><path d="M4 6h16M4 12h16M4 18h16"></path></svg>
                <svg id="x-icon" class="icon hidden" viewBox="0 0 24 24"><path d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
        </div>
        <div id="mobile-menu" class="mobile-menu">
            <a href="#inicio">Início</a>
            <a href="#sobre">Sobre Nós</a>
            <a href="#servicos">Serviços</a>
            <a href="#galeria">Galeria</a>
            <a href="#orcamentos">Orçamentos</a>
            <a href="#contactos">Contactos</a>
            <a href="#orcamentos" class="btn btn-primary">Pedir Orçamento</a>
        </div>
    </header>

    <main>
        <!-- HERO SECTION -->
        <section id="inicio" class="hero">
            <div class="hero-content">
                <h1>
                    <span>RECOOP</span>
                    <!-- داخل بخش HERO, بعد از <span>RECOOP</span> -->
                    <img id="hero-icon" src="siterecoop media/—Pngtree—3d closeup of paint roller_15712816.png" alt="RECOOP icon" />


                    <span class="subtitle">Reabilitação e Recuperação de Casas e Edifícios</span>
                </h1>
                <p>
                    A RECOOP é especialista em reabilitação, recuperação e remodelação, aliando técnicas modernas à valorização da arquitetura tradicional portuguesa.
                </p>
                <div class="hero-buttons">
                    <a href="#servicos" class="btn btn-primary">Nossos Serviços</a>
                    <a href="#orcamentos" class="btn btn-secondary">Avaliação Gratuita</a>
                </div>
            </div>
        </section>




        <section id="servicos" class="section section-dark">
            <div class="container text-center">
              <h2 class="section-subtitle">Serviços</h2>
              <div id="services-pin" class="services-pin" aria-hidden="true"></div>
          
              <h3 class="section-title">Soluções completas para o seu imóvel</h3>
              <p class="section-description">
                Do telhado à cave, oferecemos uma vasta gama de serviços especializados para dar uma nova vida ao seu espaço.
              </p>
          
              <div id="services-grid" class="services-grid">
                <!-- Service cards will be inserted here by JavaScript -->
              </div>
            </div>
          </section>



        <!-- ABOUT SECTION -->
        <section id="sobre" class="section">
            <div class="container text-center">
                <h2 class="section-subtitle">Sobre Nós</h2>
                <h3 class="section-title">O seu parceiro de confiança em reabilitação</h3>
                <p class="section-description">
                    Combinamos técnicas modernas com um profundo respeito pela arquitetura tradicional.
                </p>
                <div class="features-grid">
                    <div class="feature-card">
                        <div class="feature-icon-wrapper">
                            <svg class="feature-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.293 2.293a1 1 0 010 1.414L10 12l-2 2 2.828 2.828a1 1 0 010 1.414L10 21M17 3l2.293 2.293a1 1 0 010 1.414L14 12l-2 2 2.828 2.828a1 1 0 010 1.414L14 21" /></svg>
                        </div>
                        <h4>A Nossa Missão</h4>
                        <p>Transformar espaços antigos em ambientes modernos, eficientes e saudáveis, respeitando o património e reduzindo o impacto ambiental.</p>
                    </div>
                    <div class="feature-card">
                         <div class="feature-icon-wrapper">
                             <svg class="feature-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M15 21a6 6 0 00-9-5.197m0 0A5.975 5.975 0 0112 13a5.975 5.975 0 013 1.803M15 21a9 9 0 00-9-5.197M15 21a9 9 0 00-9-5.197" /></svg>
                        </div>
                        <h4>Equipa Técnica</h4>
                        <p>Profissionais qualificados e experientes, prontos para executar cada obra com rigor técnico e acompanhamento personalizado.</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon-wrapper">
                           <svg class="feature-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                        </div>
                        <h4>Certificações e Garantias</h4>
                        <p>Trabalhamos com materiais certificados e oferecemos garantias RECOOP, assegurando soluções sustentáveis, ecológicas e duradouras.</p>
                    </div>
                </div>
            </div>
        </section>

       

       
        <!-- MATERIALS SECTION -->
        <section id="materiais" class="section section-dark">
          <div class="container two-column-layout">
            <div class="column-text">
                <h2 class="section-subtitle">Produtos & Materiais</h2>
                <h3 class="section-title">Qualidade e Sustentabilidade</h3>
                <p>Selecionamos cuidadosamente os melhores materiais do mercado, com foco na durabilidade, eficiência energética e baixo impacto ambiental.</p>
                <ul class="materials-list">
                  <li>Isolamentos e Impermeabilizantes</li>
                  <li>Revestimentos em Madeira e Pedra</li>
                  <li>Tintas e Vernizes Ecológicos</li>
                  <li>Materiais Reciclados</li>
                  <li>Sistemas Solares e Energéticos</li>
                </ul>
            </div>
            <div class="column-image">
                <img src="siterecoop media/recoop_workers_4.png" alt="Materiais de construção sustentáveis" />
            </div>
          </div>
        </section>

         <!-- GALLERY SECTION -->
         <section id="galeria" class="section">
            <div class="container text-center">
                <h2 class="section-subtitle">Galeria de Projetos</h2>
                <h3 class="section-title">Transformamos visões em realidade</h3>
                <p class="section-description">
                    Explore alguns dos nossos trabalhos e veja a qualidade e dedicação que colocamos em cada projeto.
                </p>
            </div>
            <div class="container gallery-container">
                 <div class="gallery-category">
                    <h4>Antes e Depois</h4>
                    <div class="gallery-grid-double">
                        <div class="before-after-pair">
                            <div class="gallery-item"><img src="siterecoop media/IMG_7526.webp" alt="Antes"></div>
                            <div class="gallery-item"><img src="siterecoop media/IMG_7559.jpeg" alt="Depois"></div>
                        </div>
                        <div class="before-after-pair">
                           <div class="gallery-item"><img src="siterecoop media/IMG_7561.jpeg" alt="Antes"></div>
                           <div class="gallery-item"><img src="siterecoop media/recoop_project_in_progress.png" alt="Depois"></div>
                        </div>
                    </div>
                </div>
                <div class="gallery-category">
                    <h4>Reabilitação de Interiores</h4>
                    <div class="gallery-grid">
                        <div class="gallery-item"><img src="siterecoop media/IMG_7512.webp" alt="Interior moderno"></div>
                        <div class="gallery-item"><img src="siterecoop media/IMG_7535.webp" alt="Cozinha renovada"></div>
                        <div class="gallery-item"><img src="siterecoop media/IMG_7513.jpeg" alt="Sala de estar"></div>
                        <div class="gallery-item"><img src="siterecoop media/IMG_7549.jpeg" alt="Interior moderno"></div>
                        <div class="gallery-item"><img src="siterecoop media/IMG_7555.jpeg" alt="Cozinha renovada"></div>
                        <div class="gallery-item"><img src="siterecoop media/IMG_7517.webp" alt="Sala de estar"></div>

                        <div class="gallery-item"><img src="siterecoop media/IMG_7556.jpeg" alt="Interior moderno"></div>
                        <div class="gallery-item"><img src="siterecoop media/IMG_7571.jpeg" alt="Cozinha renovada"></div>
                        <div class="gallery-item"><img src="siterecoop media/IMG_7586_1.jpeg" alt="Sala de estar"></div>
                    </div>
                </div>
            </div>
        </section>


        <!-- QUOTE SECTION -->
        <section id="orcamentos" class="section">
            <div class="container two-column-layout">
                <div class="column-text">
                    <h2 class="section-subtitle">Orçamentos</h2>
                    <h3 class="section-title">Quer receber um orçamento gratuito?</h3>
                    <p>Preencha o formulário e a nossa equipa entrará em contacto para agendar uma avaliação gratuita do seu projeto. Dê o primeiro passo para transformar o seu espaço.</p>
                </div>
                <div class="form-container">
                    <form id="quote-form">
                        <div class="form-group">
                            <label for="name">Nome</label>
                            <input type="text" name="name" id="name" required />
                        </div>
                        <div class="form-group">
                            <label for="email">Email</label>
                            <input type="email" name="email" id="email" required />
                        </div>
                        <div class="form-group">
                            <label for="message">Mensagem / Descrição do Projeto</label>
                            <textarea name="message" id="message" rows="4" required></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary btn-full">Pedir Visita Técnica</button>
                    </form>
                    <div id="success-message" class="hidden">
                        <h3>Obrigado!</h3>
                        <p>A sua mensagem foi enviada com sucesso. Entraremos em contacto em breve.</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- FOOTER -->
    <footer id="contactos" class="footer">
        <div class="container footer-grid">
            <div class="footer-column">
                <h4 class="logo">RECOOP<span>.</span></h4>
                <p>Reabilitação e Recuperação de Casas e Edifícios.</p>
                <p>Respeitando o património, valorizando a estética e reduzindo o impacto ambiental.</p>
            </div>
            <div class="footer-column">
                <h4>Contactos</h4>
                <ul class="contact-list">
                    <li><a href="mailto:geral@recoop.pt">geral@recoop.pt</a></li>
                    <li>+351 000 000 000</li>
                    <li>Portugal</li>
                </ul>
            </div>
            <div class="footer-column">
                <h4>Redes Sociais</h4>
                <div class="social-links">
                     <a href="#" aria-label="Facebook"><svg viewBox="0 0 24 24"><path d="M9 8h-3v4h3v12h5v-12h3.642l.358-4h-4v-1.667c0-.955.192-1.333 1.115-1.333h2.885v-5h-3.808c-3.596 0-5.192 1.583-5.192 4.615v2.385z" /></svg></a>
                     <a href="#" aria-label="Instagram"><svg viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.85s-.011 3.585-.069 4.85c-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07s-3.585-.012-4.85-.07c-3.252-.148-4.771-1.691-4.919-4.919-.058-1.265-.07-1.645-.07-4.85s.012-3.585.07-4.85c.149-3.225 1.664-4.771 4.919-4.919 1.266-.058 1.644-.07 4.85-.07zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948s.014 3.667.072 4.947c.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072s3.667-.014 4.947-.072c4.358-.2 6.78-2.618 6.98-6.98.059-1.281.073-1.689.073-4.948s-.014-3.667-.072-4.947c-.2-4.358-2.618-6.78-6.98-6.98-1.281-.059-1.689-.073-4.948-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.162 6.162 6.162 6.162-2.759 6.162-6.162-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4s1.791-4 4-4 4 1.79 4 4-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44 1.441-.645 1.441-1.44-.645-1.44-1.441-1.44z" /></svg></a>
                     <a href="#" aria-label="LinkedIn"><svg viewBox="0 0 24 24"><path d="M4.98 3.5c0 1.381-1.11 2.5-2.48 2.5s-2.48-1.119-2.48-2.5c0-1.38 1.11-2.5 2.48-2.5s2.48 1.12 2.48 2.5zm.02 4.5h-5v16h5v-16zm7.982 0h-4.968v16h4.969v-8.399c0-4.67 6.029-4.484 6.029 0v8.399h4.988v-10.131c0-7.88-8.922-7.593-11.018-3.714v-2.155z" /></svg></a>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2024 RECOOP. Todos os direitos reservados.</p>
        </div>
    </footer>
    
    <script>document.addEventListener('DOMContentLoaded', () => {

        // --- HEADER SCROLL & MOBILE MENU LOGIC ---
        const header = document.getElementById('main-header');
        const menuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');
        const menuIcon = document.getElementById('menu-icon');
        const xIcon = document.getElementById('x-icon');
    
        // Handle header background on scroll
        window.addEventListener('scroll', () => {
            if (window.scrollY > 50) {
                header.classList.add('scrolled');
            } else {
                header.classList.remove('scrolled');
            }
        });
    
        // Toggle mobile menu
        menuButton.addEventListener('click', () => {
            const isMenuOpen = mobileMenu.classList.toggle('open');
            menuButton.setAttribute('aria-expanded', isMenuOpen);
            menuIcon.classList.toggle('hidden', isMenuOpen);
            xIcon.classList.toggle('hidden', !isMenuOpen);
        });
        
        // Close mobile menu when a link is clicked
        mobileMenu.querySelectorAll('a').forEach(link => {
            link.addEventListener('click', () => {
                mobileMenu.classList.remove('open');
                menuButton.setAttribute('aria-expanded', 'false');
                menuIcon.classList.remove('hidden');
                xIcon.classList.add('hidden');
            });
        });
    
    
        // --- DYNAMICALLY CREATE SERVICE CARDS ---
        document.addEventListener('DOMContentLoaded', () => {
          console.log('services script running (DOMContentLoaded)');
        
          // اگر می‌خوای نام پوشه رو عوض کنی فقط این BASE را تغییر بده
          const BASE_IMG_PATH = '/siterecoopmedia/'; // قرار بده در public/siterecoopmedia/ در Netlify
        
          // داده‌ها — فقط نام فایل آیکون، نه مسیر کامل (برای جلوگیری از اشتباهات مسیر)
          const servicesData = [
            { title: "Reabilitação Estrutural", iconFile: 'recoop_stone_wall_imitation.png', items: ["Reforço de vigas, lajes e fundações", "Recuperação de paredes antigas", "Tratamento de humidades e fissuras", "Reabilitação sísmica e estrutural"] },
            { title: "Telhados e Coberturas", iconFile: 'recoop_portuguese_roof_tile.jpeg', items: ["Substituição e isolamento de telhados", "Impermeabilização e drenagem", "Aplicação de telhas diversas", "Coberturas verdes e ecológicas"] },
            { title: "Fachadas e Revestimentos", iconFile: 'recoop_etics_application.jpeg', items: ["Capoto / ETICS", "Imitação de pedra e madeira", "Revestimentos em pedra natural", "Pinturas exteriores e proteção"] },
            { title: "Divisórias, Tetos e Isolamentos", iconFile: 'recoop_workers_3.png', items: ["Pladur / Gesso cartonado", "Isolamento térmico e acústico", "Tetos acústicos e decorativos", "Isolamentos interiores e de caves"] },
            { title: "Carpintarias e Acabamentos", iconFile: 'recoop_wood_imitation_railing.png', items: ["Portas, janelas e caixilharias", "Pavimentos vinílicos e flutuantes", "Revestimentos em madeira", "Mobiliário ecológico e reciclado"] },
            { title: "Canalização e Eletricidade", iconFile: 'recoop_home_repairs.png', items: ["Substituição de canalizações", "Instalação de águas e esgotos", "Instalação elétrica, LED e domótica", "Painéis solares e carregadores"] },
            { title: "Pinturas e Decoração", iconFile: 'recoop_painter.png', items: ["Pinturas com tintas ecológicas", "Estuques decorativos e cimento", "Lacagens e vernizes naturais", "Design e decoração ambiental"] },
            { title: "Sustentabilidade e Energia", iconFile: 'recoop_solar_panels.png', items: ["Painéis solares fotovoltaicos", "Sistemas off-grid e baterias", "Captação de águas pluviais", "Casas com baixo consumo"] }
          ];
        
          const servicesGrid = document.getElementById('services-grid');
          const servicesPin = document.getElementById('services-pin');
        
          if (!servicesGrid) {
            console.error('services-grid not found in DOM — make sure HTML includes <div id=\"services-grid\">');
            return;
          }
          if (!servicesPin) {
            console.warn('services-pin not found; pin functionality disabled');
          }
        
          // create pin image element once
          let pinImg = null;
          if (servicesPin) {
            pinImg = document.createElement('img');
            pinImg.className = 'pin-img';
            // optional placeholder (data URL tiny transparent) — replace with real placeholder if you want
            pinImg.src = 'data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=';
            servicesPin.appendChild(pinImg);
          }
        
          // utility: build full image URL
          function imgUrl(fileName) {
            if (!fileName) return '';
            // normalize: trim, lowercase
            return BASE_IMG_PATH + fileName.trim();
          }
        
          // placeholder in case of image error (change path if you add a real placeholder)
          const FALLBACK_IMG = imgUrl('placeholder.png') || 'data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=';
        
          // create cards
          servicesData.forEach((svc, idx) => {
            const card = document.createElement('div');
            card.className = 'service-card';
            card.setAttribute('data-service-idx', idx);
        
            // header
            const header = document.createElement('div');
            header.className = 'service-card-header';
        
            // icon img element
            const iconWrapper = document.createElement('div');
            iconWrapper.className = 'service-icon-wrapper';
            const img = document.createElement('img');
            img.className = 'service-icon';
            img.alt = svc.title;
            img.src = imgUrl(svc.iconFile);
        
            // image error handling
            img.addEventListener('error', () => {
              console.warn('Image failed to load:', img.src);
              img.src = FALLBACK_IMG;
            });
        
            iconWrapper.appendChild(img);
            header.appendChild(iconWrapper);
        
            // title
            const h4 = document.createElement('h4');
            h4.textContent = svc.title;
            header.appendChild(h4);
        
            card.appendChild(header);
        
            // items list
            const ul = document.createElement('ul');
            svc.items.forEach(itemText => {
              const li = document.createElement('li');
              li.textContent = itemText;
              ul.appendChild(li);
            });
            card.appendChild(ul);
        
            // event handlers: hover -> show in pin; click -> toggle selected
            let selected = false;
            card.addEventListener('mouseenter', () => {
              if (!pinImg) return;
              pinImg.src = imgUrl(svc.iconFile);
              servicesPin.classList.add('pin-filled');
              console.log('pin show (hover):', svc.iconFile);
            });
            card.addEventListener('mouseleave', () => {
              if (!pinImg) return;
              if (!selected) {
                // clear pin (set to transparent tiny gif)
                pinImg.src = 'data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=';
                servicesPin.classList.remove('pin-filled');
                console.log('pin cleared (mouseleave)');
              }
            });
            card.addEventListener('click', () => {
              selected = !selected;
              if (selected) {
                pinImg.src = imgUrl(svc.iconFile);
                servicesPin.classList.add('pin-filled');
                card.style.boxShadow = '0 6px 18px rgba(0,0,0,0.12)';
                console.log('card selected:', svc.title);
              } else {
                pinImg.src = 'data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=';
                servicesPin.classList.remove('pin-filled');
                card.style.boxShadow = '';
                console.log('card deselected:', svc.title);
              }
            });
        
            servicesGrid.appendChild(card);
            console.log('Appended service card:', svc.title, 'img:', img.src);
          });
        
          console.log('services-grid children count:', servicesGrid.children.length);
        });
    
      }
    )
    
    
    
    // Smooth scroll-follow + snap loop for hero icon -> services pin
    (function(){
        const orig = document.getElementById('hero-icon');
        const target = document.getElementById('services-pin');
        if (!orig || !target) return;
      
        // تنظیمات پیش‌فرض — می‌تونی تغییر بدی
        const settings = {
          startViewportFactor: window.innerWidth <= 560 ? 0.090 : 0.09,
          endViewportFactor:   window.innerWidth <= 560 ? 0.80 : 0.85,
          snapThreshold:       window.innerWidth <= 560 ? 0.64 : 0.66,
          snapDuration:        20,   // ms
          hideOnScrollPx:      window.innerWidth <= 560 ? 2 : 5
        };
      
        let clone = null;
        let ticking = false;
        let currentP = 0;
      
        const clamp = (v,a=0,b=1) => Math.max(a, Math.min(b, v));
      
        function createCloneIfNeeded(){
          if (clone) return clone;
          const r = orig.getBoundingClientRect();
          clone = document.createElement('div');
          clone.className = 'floating-clone';
          clone.style.width = r.width + 'px';
          clone.style.height = r.height + 'px';
          // left/top initial (fixed coords matching orig position in viewport)
          clone.style.left = r.left + 'px';
          clone.style.top  = r.top  + 'px';
      
          // copy image if orig is <img>
          if (orig.tagName.toLowerCase() === 'img' && orig.src) {
            clone.style.backgroundImage = `url("${orig.src}")`;
            clone.style.backgroundSize = 'contain';
            clone.style.backgroundRepeat = 'no-repeat';
            clone.style.backgroundPosition = 'center';
          } else {
            const bg = window.getComputedStyle(orig).backgroundImage;
            if (bg && bg !== 'none') clone.style.backgroundImage = bg;
          }
      
          document.body.appendChild(clone);
          return clone;
        }
      
        function removeClone(){
          if (clone){
            clone.remove();
            clone = null;
          }
        }
      
        function fillTargetImg(){
          if (!target.querySelector('img.pin-img')) {
            const img = document.createElement('img');
            img.className = 'pin-img';
            if (orig.tagName.toLowerCase() === 'img' && orig.src) img.src = orig.src;
            else {
              const bg = window.getComputedStyle(orig).backgroundImage;
              const m = /url\(\"?(.+?)\"?\)/.exec(bg);
              if (m && m[1]) img.src = m[1];
            }
            img.alt = orig.alt || 'icon';
            target.appendChild(img);
            target.classList.add('pin-filled');
          }
          // remove clone and keep orig hidden while pinned
          removeClone();
          orig.style.visibility = 'hidden';
        }
      
        function clearTargetImg(){
          const img = target.querySelector('img.pin-img');
          if (img) img.remove();
          target.classList.remove('pin-filled');
          orig.style.visibility = 'visible';
        }
      
        // compute progress (0..1)
        function computeProgress(){
          const oRect = orig.getBoundingClientRect();
          const tRect = target.getBoundingClientRect();
          const scrollY = window.scrollY || window.pageYOffset;
      
          // centers in page coords
          const origCenterPage = {
            x: oRect.left + oRect.width/2 + window.scrollX,
            y: oRect.top  + oRect.height/2 + scrollY
          };
          const targetCenterPage = {
            x: tRect.left + tRect.width/2 + window.scrollX,
            y: tRect.top  + tRect.height/2 + scrollY
          };
      
          const startViewportY = window.innerHeight * settings.startViewportFactor;
          const endViewportY   = window.innerHeight * settings.endViewportFactor;
      
          const startTrigger = origCenterPage.y - startViewportY;
          const endTrigger   = targetCenterPage.y - endViewportY;
          const total = endTrigger - startTrigger || 1;
          const p = (scrollY - startTrigger) / total;
          return clamp(p, 0, 1);
        }
      
        // apply exact transform (follow mode) - no smoothing
        function applyDirect(p){
          createCloneIfNeeded();
          // remove snap class so transform updates immediately (no CSS transition)
          clone.classList.remove('smooth-snap');
      
          const oRect = orig.getBoundingClientRect();
          const tRect = target.getBoundingClientRect();
          const scrollY = window.scrollY || window.pageYOffset;
      
          const origCenterPage = {
            x: oRect.left + oRect.width/2 + window.scrollX,
            y: oRect.top  + oRect.height/2 + scrollY
          };
          const targetCenterPage = {
            x: tRect.left + tRect.width/2 + window.scrollX,
            y: tRect.top  + tRect.height/2 + scrollY
          };
      
          const dx = targetCenterPage.x - origCenterPage.x;
          const dy = targetCenterPage.y - origCenterPage.y;
      
          const translateX = dx * p;
          const translateY = dy * p;
      
          clone.style.transform = `translate(${translateX}px, ${translateY}px) translateZ(0)`;
          // hide orig when p > 0 (we want clone visible)
          orig.style.visibility = (p > 0.001 || (window.scrollY || window.pageYOffset) > settings.hideOnScrollPx) ? 'hidden' : 'visible';
        }
      
        // when hitting snap threshold: do smooth snap to final place then finalize
        function applySnapThenFinalize(){
          createCloneIfNeeded();
          // compute final dx/dy
          const oRect = orig.getBoundingClientRect();
          const tRect = target.getBoundingClientRect();
          const scrollY = window.scrollY || window.pageYOffset;
      
          const origCenterPage = {
            x: oRect.left + oRect.width/2 + window.scrollX,
            y: oRect.top  + oRect.height/2 + scrollY
          };
          const targetCenterPage = {
            x: tRect.left + tRect.width/2 + window.scrollX,
            y: tRect.top  + tRect.height/2 + scrollY
          };
      
          const dx = targetCenterPage.x - origCenterPage.x;
          const dy = targetCenterPage.y - origCenterPage.y;
      
          // enable smooth snap transition
          clone.classList.add('smooth-snap');
          clone.style.transform = `translate(${dx}px, ${dy}px) translateZ(0)`;
      
          // after transition end, finalize into target
          const onTrans = (e) => {
            if (e && e.propertyName && e.propertyName.indexOf('transform') === -1) return;
            clone && clone.removeEventListener('transitionend', onTrans);
            fillTargetImg();
          };
          clone.addEventListener('transitionend', onTrans);
      
          // safety fallback
          setTimeout(()=> {
            if (document.body.contains(clone)) fillTargetImg();
          }, settings.snapDuration + 80);
        }
      
        // main update method (called within RAF)
        function update(){
          ticking = false;
          const p = computeProgress();
          currentP = p;
      
          // immediate hide orig as soon as scrolling beyond tiny px
          if ((window.scrollY || window.pageYOffset) > settings.hideOnScrollPx) {
            orig.style.visibility = 'hidden';
          }
      
          // if below snap threshold -> follow mode
          if (p < settings.snapThreshold) {
            // if target currently has pin-filled (we were snapped) but now we start moving up: 
            // remove pin and spawn clone at the visual position corresponding to p, then follow
            if (target.classList.contains('pin-filled')) {
              // remove image from target but create clone positioned as if p==1, then applyDirect(p)
              const prevImg = target.querySelector('img.pin-img');
              if (prevImg) prevImg.remove();
              target.classList.remove('pin-filled');
              // create clone and ensure it's visually at p==1 position
              createCloneIfNeeded();
              // immediately set transform to final pos (p=1) to start smoothly from there
              // compute dx/dy for p=1:
              const oRect = orig.getBoundingClientRect();
              const tRect = target.getBoundingClientRect();
              const scrollY = window.scrollY || window.pageYOffset;
      
              const origCenterPage = {
                x: oRect.left + oRect.width/2 + window.scrollX,
                y: oRect.top  + oRect.height/2 + scrollY
              };
              const targetCenterPage = {
                x: tRect.left + tRect.width/2 + window.scrollX,
                y: tRect.top  + tRect.height/2 + scrollY
              };
              const dx = targetCenterPage.x - origCenterPage.x;
              const dy = targetCenterPage.y - origCenterPage.y;
              // place clone visually at p=1 immediately (no transition)
              clone.classList.remove('smooth-snap');
              clone.style.transform = `translate(${dx}px, ${dy}px) translateZ(0)`;
              // then apply follow based on current p (< snapThreshold)
              applyDirect(p);
            } else {
              // normal follow
              applyDirect(p);
            }
      
            // cleanup when scrolled fully to top
            if (p <= 0.001 && (window.scrollY || window.pageYOffset) <= settings.hideOnScrollPx) {
              removeClone();
              clearTargetImg();
              orig.style.visibility = 'visible';
            }
            return;
          }
      
          // p >= snapThreshold -> snap final (if not already finalized)
          if (!target.classList.contains('pin-filled')) {
            // ensure clone exists at current pos, then snap
            createCloneIfNeeded();
            applyDirect(p); // set current transform
            // force reflow
            clone.offsetHeight;
            applySnapThenFinalize();
          }
        }
      
        // RAF wrapper to avoid multiple runs
        function requestTick(){
          if (!ticking) {
            ticking = true;
            requestAnimationFrame(update);
          }
        }
      
        function onScrollOrResize(){
          // on scroll we request an update; orig visibility immediate hide on tiny scroll
          requestTick();
        }
      
        window.addEventListener('scroll', onScrollOrResize, { passive: true });
        window.addEventListener('resize', () => {
          // reset on resize to avoid mismatches
          removeClone();
          clearTargetImg();
          requestTick();
        });
      
        // init
        requestTick();
    
    
    
        // --- find mid section between hero (inicio) and servicos ---
    let midSection = null;
    function findMidSection() {
      try {
        const sections = Array.from(document.querySelectorAll('section'));
        const heroIndex = sections.findIndex(s => s.id === 'inicio' || s.id === 'hero' || s.classList.contains('hero'));
        const servIndex = sections.findIndex(s => s.id === 'servicos' || s.id === 'servicos' || s.classList.contains('section-dark') && s.id === 'servicos');
        // fallback: تلاش معمولی بر اساس id اگر بالا پیدا نشد
        const servIndexFixed = sections.findIndex(s => s.id === 'servicos');
        const hIdx = heroIndex >= 0 ? heroIndex : sections.findIndex(s => s.id === 'inicio');
        const sIdx = servIndex >= 0 ? servIndex : servIndexFixed;
    
        midSection = null;
        if (hIdx >= 0 && sIdx >= 0 && sIdx - hIdx > 1) {
          // اگر بین آنها یک یا چند section هست، انتخاب کن نزدیک‌ترین به servicos (آخرین قبل از servicos)
          const candidates = sections.slice(hIdx + 1, sIdx);
          if (candidates.length) {
            midSection = candidates[candidates.length - 1]; // آخرین بخش بین دو تا
          }
        }
      } catch (e) {
        midSection = null;
      }
    }
    
    // فراخوانی اولیه و on resize
    findMidSection();
    window.addEventListener('resize', () => {
      findMidSection();
    });
    
    // --- computeProgress (جایگزین تابع قدیمی) ---
    function computeProgress(){
      const origRect = orig.getBoundingClientRect();
      const targetRect = target.getBoundingClientRect();
    
      // مراکز در page coords
      const scrollY = window.scrollY || window.pageYOffset;
      const origCenterPage = {
        x: origRect.left + origRect.width/2 + window.scrollX,
        y: origRect.top + origRect.height/2 + scrollY
      };
      const targetCenterPage = {
        x: targetRect.left + targetRect.width/2 + window.scrollX,
        y: targetRect.top + targetRect.height/2 + scrollY
      };
    
      // نقاط viewport برای شروع/پایان (بر اساس تنظیمات)
      const startViewportY = window.innerHeight * settings.startViewportFactor;
      const endViewportY   = window.innerHeight * settings.endViewportFactor;
    
      // محاسبه تریگرهای پایه
      const startTrigger = origCenterPage.y - startViewportY;
      let endTrigger = targetCenterPage.y - endViewportY;
    
      // اگر midSection وجود داشت، مطمئن شو endTrigger طوری تنظیم بشه که
      // آیکون قبل از " گذر کامل یا تا نقطه مشخصِ " midSection " زودتر ختم نشود.
      if (midSection) {
        const mRect = midSection.getBoundingClientRect();
        const midBottomPage = mRect.top + mRect.height + window.scrollY; // پایین midSection در page coords
    
        // مقدار بسیار محافظه‌کارانه: اجازه نده endTrigger کوچکتر از نقطه‌ای شود
        // که midSection تا 20% از بالای viewport عبور نکرده (یعنی midBottomPage - 0.2*vh)
        const midRequiredY = midBottomPage - (window.innerHeight * 0.20);
    
        // اگر endTrigger قبل از این مقدار می‌افتاد، آن را جابجا کن تا snap دیرتر اتفاق بیفتد
        if (endTrigger < midRequiredY) {
          endTrigger = midRequiredY;
        }
      }
    
      const total = endTrigger - startTrigger || 1;
      const p = (scrollY - startTrigger) / total;
      return Math.max(0, Math.min(1, p));
    }
    
      })();
      </script>
<script type="module" src="/index.tsx"></script>


</body>
</html>
